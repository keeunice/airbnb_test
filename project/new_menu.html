<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Cards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .container {
            width: 90%;
            margin: 0 auto;
            padding: 20px 0;
        }

        .section-title {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .teacard-row {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            justify-content: start;
        }

        .teacard {
            max-width: 200px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 10px;
            transition: transform 0.3s ease;
        }

        .teacard:hover {
            transform: scale(1.05);
        }

        .teacard img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
        }

        .teacard-content {
            text-align: center;
            padding: 10px 0;
        }

        .teacard-content h3 {
            font-size: 1.1em;
            margin: 0 0 5px;
        }

        .teacard-content p {
            font-size: 1em;
            margin: 0;
            color: #555;
        }
        /* å°è©±æ¡† styles */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 300px;
            max-width: 90%;
            z-index: 1000;
            padding: 20px;
        }

        .modal h3 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .modal p {
            font-size: 18px;
            margin: 10px 0;
        }

        #size {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        #sweetness {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        #ice {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        #quantity-controls {
            display: flex-left;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #quantity-controls button {
            width: 20px; /* çµ±ä¸€æŒ‰éˆ•å¯¬åº¦ */
            height: 20px; /* çµ±ä¸€æŒ‰éˆ•é«˜åº¦ */
            font-size: 15px;
            font-weight: bold;
            text-align: center;
            background-color: #3f4851;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #quantity-controls button:hover {
            background-color: #0056b3;
        }

        #quantity-display {
            font-size: 18px;
            font-weight: normal;
            width: 20px;
            text-align: center;
        }

        .price-container span {
            font-size: 1em;
            margin-right: 10px;
            margin-top: 0.5cm;
        }

        .modal #check {
            width: 100%;
            padding: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 0.25cm;
        }

        .modal #check:hover {
            background-color: #0056b3;
        }

        .modal #cancel1 {
            width: 100%;
            padding: 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 0.25cm;            
        }

        .modal #cancel1:hover {
            background-color: #b02a37;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }


        /* è³¼ç‰©è»ŠæŒ‰éˆ•æ¨£å¼ */
        .cart-button {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #ff5722;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 101; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
        }

        .cart-button:hover {
            background-color: #e64a19;
        }

        .cart-button:active {
            background-color: #d84315;
        }


        /* è³¼ç‰©è»Š Dialog æ¨£å¼ */
        .cart-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 400px;
            max-height: 60%;
            overflow: auto;
            padding: 20px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000; /* ç¢ºä¿ Dialog åœ¨è³¼ç‰©è»ŠæŒ‰éˆ•ä¹‹ä¸Š */
        }

        #cart-items-list {
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .cart-item-details {
            flex: 1;
                    }

        .cart-item-details h3 {
            font-size: 18px;
            font-weight: bold;
        }

        .cart-item-details .item-description {
            font-size: 14px;
            margin-top: 5px;
        }

        .cart-item-price {
            text-align: right;
            width: 120px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        .quantity-controls button {
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
        }

        .cart-item-price span {
            font-size: 16px;
            font-weight: bold;
        }


        /* ç¢ºèªèˆ‡å–æ¶ˆæŒ‰éˆ•æ¨£å¼ */
        .dialog-actions {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            margin-top: 10px;
            background-color: #f4f4f4;
            border-top: 1px solid #ccc;
        }

        .dialog-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        .confirm-button {
            background-color: #4CAF50;
            color: white;
        }

        .confirm-button:hover {
            background-color: #45a049;
        }

        .cancel-button {
            background-color: #f44336;
            color: white;
        }

        .cancel-button:hover {
            background-color: #e53935;
        }

        
    </style>
</head>
<body>
    <!-- è³¼ç‰©è»ŠæŒ‰éˆ• -->
    <button id="cart-button" class="cart-button">
     ğŸ›’ è³¼ç‰©è»Š
    </button>

    <!-- è³¼ç‰©è»Š Dialog -->
    <div id="cart-dialog" class="cart-dialog">
        <h2>è³¼ç‰©è»Šå…§å®¹</h2>
        <div id="cart-items-list"></div>
        <div class="dialog-actions">
            <button id="confirm" class="confirm-button">ç¢ºèª</button>
            <button id="cancel" class="cancel-button">å–æ¶ˆ</button>
        </div>
    </div>

    <div class="container">
        <!-- Tea Section -->
        <div class="section">
            <h2 class="section-title">èŒ¶é¡</h2>
            <div class="teacard-row">
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>ç´…èŒ¶</h3>
                        <p>$10</p>
                    </div>
                    <img src="https://img.ltn.com.tw/Upload/food/page/2016/09/11/160911-3349-0-EqE8q.jpg" alt="ç´…èŒ¶">
                </div>                                
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>ç¶ èŒ¶</h3>
                        <p>$15</p>
                    </div>
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSUuo_pyV9Ka3QbIsNA4XOvEu5yVS_0sh9ehg&s" alt="ç¶ èŒ¶">
                </div>
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>çƒé¾èŒ¶</h3>
                        <p>$25</p>
                    </div>
                    <img src="https://shoplineimg.com/5e8fd3429e08ce003190913d/6135cb25949402002f8911ef/800x.jpg?" alt="ç¶ èŒ¶">
                </div>
            </div>
        </div>

        <!-- Frappuccino Section -->
        <div class="section">
            <h2 class="section-title">æ˜Ÿå†°æ¨‚</h2>
            <div class="teacard-row">
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>å¯å¯æ˜Ÿå†°æ¨‚</h3>
                        <p>$90</p>
                    </div>
                    <img src="https://i1.momoshop.com.tw/1703734981/goodsimg/0011/806/605/11806605_O_m.webp" alt="å¯å¯æ˜Ÿå†°æ¨‚">
                </div>
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>å’–å•¡æ˜Ÿå†°æ¨‚</h3>
                        <p>$80</p>
                    </div>
                    <img src="https://www.starbucks.com.tw/common/objects/images/product/20211001141659501.jpg" alt="å’–å•¡æ˜Ÿå†°æ¨‚">
                </div>
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>æŠ¹èŒ¶æ˜Ÿå†°æ¨‚</h3>
                        <p>$95</p>
                    </div>
                    <img src="https://img.pchome.com.tw/cs/items/DBCRL8A900FFZ57/000001_1704041161.jpg" alt="æŠ¹èŒ¶æ˜Ÿå†°æ¨‚">
                </div>
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>ç„¦ç³–æ˜Ÿå†°æ¨‚</h3>
                        <p>$85</p>
                    </div>
                    <img src="https://www.starbucks.com.tw/common/objects/images/product/20211001141919985.jpg" alt="ç„¦ç³–æ˜Ÿå†°æ¨‚">
                </div>                
            </div>
        </div>

        <!-- Latte Section -->
        <div class="section">
            <h2 class="section-title">é‚£å ¤</h2>
            <div class="teacard-row">
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>æ¿ƒç¸®å’–å•¡</h3>
                        <p>$80</p>
                    </div>
                    <img src="https://www.starbucks.com.tw/common/objects/images/product/20211001111836332.jpg" alt="æ¿ƒç¸®é‚£å ¤">
                </div>
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>ç„¦ç³–ç‘ªå¥‡æœµ</h3>
                        <p>$100</p>
                    </div>
                    <img src="https://www.starbucks.com.tw/common/objects/images/product/20211001112237837.jpg" alt="ç„¦ç³–ç‘ªå¥‡æœµé‚£å ¤">
                </div>
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>æ‘©å¡</h3>
                        <p>$110</p>
                    </div>
                    <img src="https://www.starbucks.com.tw/common/objects/images/product/20230908113144918.jpg" alt="æ‘©å¡é‚£å ¤">
                </div>
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>ç¾å¼å’–å•¡</h3>
                        <p>$85</p>
                    </div>
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTanT6awDgvXbVYOczGb3eQn2aWgWmw0DnD5A&s" alt="ç¾å¼é‚£å ¤">
                </div>
                <div class="teacard">
                    <div class="teacard-content">
                        <h3>å¡å¸ƒå¥‡è«¾</h3>
                        <p>$120</p>
                    </div>
                    <img src="https://www.starbucks.com.tw/common/objects/images/product/20211001110857273.jpg" alt="å¡å¸ƒå¥‡è«¾">
                </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="cart-overlay"></div>

    <!-- Modal -->
    <div class="overlay"></div>
    <div class="modal">
        <h3 id="modal-title"></h3>
        <p>å°ºå¯¸</p>
        <select id="size">
            <option value="ä¸­æ¯">ä¸­æ¯</option>
            <option value="å¤§æ¯">å¤§æ¯</option>
            <option value="ç‰¹å¤§æ¯">ç‰¹å¤§æ¯</option>
        </select>
        <p>ç”œåº¦</p>
        <select id="sweetness">
            <option value="ç„¡ç³–">ç„¡ç³–</option>
            <option value="å¾®ç³–">å¾®ç³–</option>
            <option value="åŠç³–">åŠç³–</option>
            <option value="å°‘ç³–">å°‘ç³–</option>
            <option value="æ­£å¸¸">æ­£å¸¸</option>            
        </select>
        <p>å†°é‡</p>
        <select id="ice">
            <option value="æº«">æº«</option>
            <option value="å»å†°">å»å†°</option>
            <option value="å¾®å†°">å¾®å†°</option>
            <option value="å°‘å†°">å°‘å†°</option>
            <option value="æ­£å¸¸">æ­£å¸¸</option>            
        </select>
        <p>æ•¸é‡</p>
        <div id="quantity-controls">
            <button id="decrease">-</button>
            <span id="quantity-display">0</span>
            <button id="increase">+</button>
        </div>
        <div class="price-container">
            <span>é‡‘é¡ï¼š</span>
            <span id="total-price">$0</span>
        </div>
        <div id="action-buttons">
            <button id="check">åŠ å…¥è³¼ç‰©è»Š</button>
            <button id="cancel1">å–æ¶ˆ</button>
        </div>
        
    </div>

    <script>
        const teacards = document.querySelectorAll('.teacard');
        const modal = document.querySelector('.modal');
        const overlay = document.querySelector('.overlay');
        const modalTitle = document.getElementById('modal-title');
        const sizeSelect = document.getElementById('size');
        const sweetnessSelect = document.getElementById('sweetness');
        const iceSelect = document.getElementById('ice');
        const checkButton = document.getElementById('check');
        const cancel1Button = document.getElementById('cancel1');
        const quantityDisplay = document.getElementById('quantity-display');
        const increaseButton = document.getElementById('increase');
        const decreaseButton = document.getElementById('decrease');
        const cartButton = document.getElementById('cart-button');
        const cartDialog = document.getElementById('cart-dialog');
        const cartOverlay = document.getElementById('cart-overlay');
        const cartItemsList = document.getElementById('cart-items-list');
        const cancelButton = document.getElementById('cancel');
        const confirmButton = document.getElementById('confirm');

        const drinks = {
            "ç´…èŒ¶": 10,
            "ç¶ èŒ¶": 15,
            "çƒé¾èŒ¶": 25,
            "å¯å¯æ˜Ÿå†°æ¨‚": 90,
            "å’–å•¡æ˜Ÿå†°æ¨‚": 80,
            "æŠ¹èŒ¶æ˜Ÿå†°æ¨‚": 95,
            "ç„¦ç³–æ˜Ÿå†°æ¨‚": 85,
            "æ¿ƒç¸®å’–å•¡": 80,
            "ç„¦ç³–ç‘ªå¥‡æœµ": 100,
            "æ‘©å¡": 110,
            "ç¾å¼å’–å•¡": 85,
            "å¡å¸ƒå¥‡è«¾": 120
        };

        const drinkSizePrice = {
            "ä¸­æ¯": 0,
            "å¤§æ¯": 10,
            "ç‰¹å¤§æ¯": 20
        };

        let quantity = 1;
        let selectedDrink = "";

        // æ‰“é–‹æ¨¡æ…‹æ¡†
        teacards.forEach(card => {
            card.addEventListener('click', () => {
                selectedDrink = card.querySelector('h3').textContent; // ç²å–å•†å“åç¨±
                modalTitle.textContent = selectedDrink;
                modal.style.display = 'block';
                overlay.style.display = 'block';
                quantity = 1; // åˆå§‹åŒ–æ•¸é‡
                sizeSelect.value = ""; // é»˜èª
                sweetnessSelect.value = ""; // é»˜èª
                iceSelect.value = ""; // é»˜èª
                quantityDisplay.textContent = quantity; // æ›´æ–°é¡¯ç¤º
                updateTotalPrice(); // æ›´æ–°åƒ¹æ ¼é¡¯ç¤º
            });
        });

        checkButton.addEventListener('click', () => {
            // æª¢æŸ¥æ˜¯å¦é¸æ“‡äº†æ‰€æœ‰å¿…è¦çš„é …ç›®
            let missingItems = [];
            if (!sizeSelect.value) missingItems.push("å°ºå¯¸");
            if (!sweetnessSelect.value) missingItems.push("ç”œåº¦");
            if (!iceSelect.value) missingItems.push("å†°é‡");

            if (missingItems.length > 0) {
                alert(`è«‹é¸æ“‡ï¼š${missingItems.join("ã€")}`);
                return; // ä¸åŸ·è¡ŒåŠ å…¥è³¼ç‰©è»Šå‹•ä½œ
            }
            addItemToCart();
            modal.style.display = 'none';
            overlay.style.display = 'none';
        });

        cancel1Button.addEventListener('click', closeModal);
        overlay.addEventListener('click', closeModal);

        // è¨ˆç®—ç¸½åƒ¹
        function calculateTotalPrice() {
            const basePrice = drinks[selectedDrink] || 0;
            const sizePrice = drinkSizePrice[sizeSelect.value] || 0;
            return (basePrice + sizePrice) * quantity;
        }

        // æ›´æ–°ç¸½åƒ¹é¡¯ç¤º
        function updateTotalPrice() {
            const totalPrice = calculateTotalPrice();
            document.getElementById('total-price').textContent = `$${totalPrice}`;
        }

        increaseButton.addEventListener('click', () => {
            quantity++;
            quantityDisplay.textContent = quantity;
            updateTotalPrice();
        });

        decreaseButton.addEventListener('click', () => {
            if (quantity > 1) {
                quantity--;
                quantityDisplay.textContent = quantity;
                updateTotalPrice();
            }
        });

        // æ›´æ”¹å°ºå¯¸æ™‚æ›´æ–°ç¸½åƒ¹
        sizeSelect.addEventListener('change', () => {
            updateTotalPrice();
        });

        function closeModal() {
            modal.style.display = 'none';
            overlay.style.display = 'none';
        }

        cartButton.addEventListener('click', () => {
            showUpdatedCart();
            cartDialog.style.display = 'block';
            cartOverlay.style.display = 'block';
        });

        function addItemToCart() {
            const cartItem = {
                item: selectedDrink,
                size: sizeSelect.value,
                sugar: sweetnessSelect.value,
                ice: iceSelect.value,
                price: calculateTotalPrice(),
                quantity: quantity
            };

            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„å•†å“
            const existingItemIndex = cart.findIndex(item =>
                item.item === cartItem.item &&
                item.size === cartItem.size &&
                item.sugar === cartItem.sugar &&
                item.ice === cartItem.ice
            );

            if (existingItemIndex !== -1) {
                // å¦‚æœå·²å­˜åœ¨ï¼Œå¢åŠ æ•¸é‡
                cart[existingItemIndex].quantity += cartItem.quantity;
            } else {
                // å¦‚æœä¸å­˜åœ¨ï¼Œæ–°å¢è‡³è³¼ç‰©è»Š
                cart.push(cartItem);
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartButton();
        }

        // æ›´æ–°è³¼ç‰©è»Šå•†å“æ•¸é‡
        function updateItemQuantity(index, action) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let item = cart[index];

            if (action === 'increase') {
                item.quantity++;
            } else if (action === 'decrease' && item.quantity > 0) {
                item.quantity--;
            }

            // å¦‚æœæ•¸é‡æ¸›è‡³ 0ï¼Œåˆªé™¤è©²å•†å“
            if (item.quantity === 0) {
                cart.splice(index, 1);
            } else {
                // æ›´æ–°åƒ¹æ ¼
                item.price = (drinks[item.item] + drinkSizePrice[item.size]) * item.quantity;
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartButton();
            showUpdatedCart();
        }

        // æ›´æ–°è³¼ç‰©è»ŠæŒ‰éˆ•æ•¸é‡é¡¯ç¤º
        function updateCartButton() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartButton.textContent = `è³¼ç‰©è»Š (${totalQuantity})`;
        }

        // åˆå§‹åŒ–è³¼ç‰©è»ŠæŒ‰éˆ•æ•¸é‡é¡¯ç¤º
        document.addEventListener('DOMContentLoaded', () => {
            updateCartButton();
        });

        function showUpdatedCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            cartItemsList.innerHTML = '';

            cart.forEach((item, index) => {
                const cartItem = document.createElement('div');
                cartItem.classList.add('cart-item');

                cartItem.innerHTML = `
                    <div class="cart-item-details">
                        <h3>${item.item}</h3>
                        <div class="item-description">
                            ${item.size} / ${item.sugar} / ${item.ice}
                        </div>
                    </div>
                    <div class="cart-item-price">
                        <div class="quantity-controls">
                            <button onclick="updateItemQuantity(${index}, 'decrease')">-</button>
                            <span>${item.quantity}</span>
                            <button onclick="updateItemQuantity(${index}, 'increase')">+</button>
                        </div>
                        <div>åƒ¹æ ¼: $${item.price}</div>
                    </div>
                `;

                cartItemsList.appendChild(cartItem);
            });
        }

        function closeDialog() {   
            cartDialog.style.display = 'none';
            cartOverlay.style.display = 'none';
        }

        confirmButton.addEventListener('click', closeDialog);
        cancelButton.addEventListener('click', closeDialog);
        cartOverlay.addEventListener('click', closeDialog);


        // åŒæ­¥è³¼ç‰©è»Šè³‡æ–™åˆ°å¾Œç«¯
        async function syncCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];

            if (cart.length === 0) {
                alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„');
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/api/cart', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cartItems: cart })  // ç§»é™¤ userId
                });

                if (response.ok) {
                    alert('è³¼ç‰©è»Šå·²æˆåŠŸåŒæ­¥è‡³å¾Œç«¯');
                    localStorage.removeItem('cart');  // æ¸…ç©ºè³¼ç‰©è»Š
                } else {
                    alert('åŒæ­¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
                }
            } catch (error) {
                console.error('åŒæ­¥éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:', error);
                alert('åŒæ­¥éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
            }
        }


        
    </script>
</body>
</html>